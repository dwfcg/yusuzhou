function DeepShare(e){var i=this,n={},a=function(a,o){if(a instanceof Array)for(var t=0;t<a.length;t++){var d=a[t];d.app_id=e;var s=new DeepShareWorker(d);s.base=i,s.SetBindInfo(o),n[d.deeplink_id]=s}else{a.app_id=e;var s=new DeepShareWorker(a);s.base=i,s.SetBindInfo(o),n[0]=s}};this._DSCallbacks={weixinIOSTipCallback:null,weixinAndroidTipCallback:null,weiboIOSTipCallback:null,weiboAndroidTipCallback:null,qqIOSTipCallback:null,qqAndroidTipCallback:null,cannotDeeplinkCallback:null,iosLandingCallback:null,androidMarketLandingCallback:null,androidDownloadLandingCallback:null,androidCannotGoMarketLandingCallback:null,iosPlatformNotAvailCallback:null,androidPlatformNotAvailCallback:null},this.BindParams=function(i){DeepShare.dsLogDebug("Try bind, inapp_data: "+JSON.stringify(i));var n=DS_kRequestProtocol+DS_kServerName+DS_kVersionName+DS_kAPIJS+e;if(i instanceof Array){for(var o=0;o<i.length;o++)i[o].deeplink_id=""+o;$.ajax({url:n,type:"POST",tryCount:0,tryLimit:3,timeout:15e3,data:JSON.stringify(i),xhrFields:{withCredentials:!0},success:function(e){a(i,e),DeepShare.dsLogDebug(""+this.tryCount+"th Params from api:"+JSON.stringify(i)+JSON.stringify(e))},error:function(e,i){DeepShare.dsLogDebug(""+this.tryCount+"th Bind Params Error: "+JSON.stringify(e)+", info: "+i),this.tryCount++,this.tryCount<this.tryLimit&&$.ajax(this)},dataType:"json"})}else i.deeplink_id="0",$.ajax({url:n,type:"POST",tryCount:0,tryLimit:3,timeout:15e3,data:JSON.stringify([i]),xhrFields:{withCredentials:!0},success:function(e){a(i,e),DeepShare.dsLogDebug(""+this.tryCount+"th Params from api:"+JSON.stringify(i)+JSON.stringify(e))},error:function(e,i){DeepShare.dsLogDebug(""+this.tryCount+"th Bind Params Error: "+JSON.stringify(e)+", info: "+i),this.tryCount++,this.tryCount<this.tryLimit&&$.ajax(this)},dataType:"json"})},this.Start=function(e){DeepShare.dsLogDebug("start worker: "+e),e?(e=""+e,n.hasOwnProperty(e)&&n[e].Start()):n[0].Start()},this.SetCallbackWeixinIOSTip=function(e){this._DSCallbacks.weixinIOSTipCallback=e},this.SetCallbackWeixinAndroidTip=function(e){this._DSCallbacks.weixinAndroidTipCallback=e},this.SetCallbackWeiboIOSTip=function(e){this._DSCallbacks.weiboIOSTipCallback=e},this.SetCallbackWeiboAndroidTip=function(e){this._DSCallbacks.weiboAndroidTipCallback=e},this.SetCallbackQQIOSTip=function(e){this._DSCallbacks.qqIOSTipCallback=e},this.SetCallbackQQAndroidTip=function(e){this._DSCallbacks.qqAndroidTipCallback=e},this.SetCallbackIOSNotAvailable=function(e){this._DSCallbacks.iosPlatformNotAvailCallback=e},this.SetCallbackAndroidNotAvailable=function(e){this._DSCallbacks.androidPlatformNotAvailCallback=e},this.SetCallbackCannotDeeplink=function(e){this._DSCallbacks.cannotDeeplinkCallback=e},this.SetCallbackIOSLanding=function(e){this._DSCallbacks.iosLandingCallback=e},this.SetCallbackAndroidMarketLanding=function(e){this._DSCallbacks.androidMarketLandingCallback=e},this.SetCallbackAndroidDownloadLanding=function(e){this._DSCallbacks.androidDownloadLandingCallback=e},this.SetCallbackAndroidCannotGoMarketLanding=function(e){this._DSCallbacks.androidCannotGoMarketLandingCallback=e},this.GetWorkers=function(){return n},this.CreateWorker=function(e){a(e,e)}}function DeepShareWorker(e){var i=this,n={INITIAL:0,BINDED:1,DISMISSED:2},a="0",o="",t="",d=n.INITIAL,s={inapp_data:{},sender_id:"",app_id:"",download_title:"",download_msg:"",download_btn_text:"",download_url_ios:"",download_url_android:"",channels:[]},r=null,l={windowLocation:function(e){window.location=e},windowOpen:function(e){window.open(e)},windowClose:function(){window.close()},windowChangeHistory:function(){window.history.replaceState("Object","Title","0")},windowAddEventListener:function(e,i){window.addEventListener(e,i)},windowUrlAddTag:function(){if(window.location.search.indexOf(DS_kDSTag)<0){var e=Math.floor(1e6*Math.random()),i="?"+DS_kDSTag+"="+e;window.location.search=i,DeepShare.dsLogDebug("Url Add Tag:"+i)}},cookieEnabled:function(){var e=!1;try{localStorage.test=2}catch(i){DeepShare.dsLogDebug("private mode"),e=!0}return navigator.cookieEnabled&&!e}},c={trackingUrl:"v2/dsactions/",actionJSDeepLink:"js/deeplink",actionJSDst:"js/dst",actionJSUserClick:"js/userclick",destination:{dstweixintipandroid:"dst-weixin-tip-android",dstweixintipios:"dst-weixin-tip-ios",dstqqtipandroid:"dst-qq-tip-android",dstqqtipios:"dst-qq-tip-ios",dstweibotipandroid:"dst-weibo-tip-android",dstweibotipios:"dst-weibo-tip-ios",dstcannotdeeplink:"dst-cannot-deeplink",dstucbrowser:"dst-uc-browser",dstios9UniversalLinkLandPage:"dst-ios9-universallink-landpage",dstandroidDirectDownloadLandPage:"dst-android-direct-download-landpage",dstandroidMarketLandPage:"dst-android-market-landpage",dstandroidCannotGoMarketLandPage:"dst-android-cannot-gomarket-landpage",dstplatformNA:"dst-{Platform}-not-available"}},u=function(e){IsNullOrUndefined(e.app_id)||(s.app_id=e.app_id),IsNullOrUndefined(e.inapp_data)||(s.inapp_data=e.inapp_data),IsNullOrUndefined(e.sender_id)||(s.sender_id=e.sender_id),IsNullOrUndefined(e.download_title)||(s.download_title=e.download_title),IsNullOrUndefined(e.download_msg)||(s.download_msg=e.download_msg),IsNullOrUndefined(e.download_btn_text)||(s.download_btn_text=e.download_btn_text),IsNullOrUndefined(e.download_url_ios)||(s.download_url_ios=e.download_url_ios),IsNullOrUndefined(e.download_url_android)||(s.download_url_android=e.download_url_android),IsNullOrUndefined(e.channels)||(s.channels=e.channels),IsNullOrUndefined(e.callbacks)||(i.base._DSCallbacks=e.callbacks),IsNullOrUndefined(e.deeplink_id)||(a=""+e.deeplink_id)},b=function(e,i){if(DeepShare.dsLogDebug("Try refresh bind, force: "+e+", binded: "+d+", deeplink_id: "+a+", match_id: "+r.match_id),e||d!==n.BINDED){var o=DS_kRequestProtocol+DS_kServerName+DS_kVersionName+DS_kAPIJS+s.app_id+"?clicked=true";$.ajax({url:o,type:"POST",data:JSON.stringify({deeplink_id:a,match_id:r.match_id,sender_id:s.sender_id,channels:s.channels,inapp_data:s.inapp_data}),timeout:800,xhrFields:{withCredentials:!0},success:function(e){DeepShare.dsLogDebug("Refresh result: "+JSON.stringify(e))},error:function(e,i){DeepShare.dsLogDebug("Refresh Bind Error: "+JSON.stringify(e)+", info: "+i)},complete:function(e,n){i&&i()},dataType:"json"})}},p=function(e,i){var n={action:e,kvs:{click_id:r.match_id,destination:i,ds_tag:r.ds_tag}},a=DS_kRequestProtocol+DS_kServerName+c.trackingUrl+r.app_id,o=JSON.stringify(n);$.post(a,o,function(e){}).error(function(){})},D=function(e){l.windowAddEventListener("pagehide",function(){DeepShare.dsLogDebug("window event pagehide"),clearTimeout(e)}),l.windowAddEventListener("blur",function(){DeepShare.dsLogDebug("window event blur"),clearTimeout(e)}),l.windowAddEventListener("unload",function(){DeepShare.dsLogDebug("window event unload"),clearTimeout(e)}),document.addEventListener("webkitvisibilitychange",function(){DeepShare.dsLogDebug("window event webkitvisibilitychange"),document.webkitHidden&&(DeepShare.dsLogDebug("window is hidden"),clearTimeout(e))}),l.windowAddEventListener("beforeunload",function(){DeepShare.dsLogDebug("window event beforeunload"),clearTimeout(e)}),l.windowAddEventListener("focus",function(){DeepShare.dsLogDebug("window event focus")}),l.windowAddEventListener("focusout",function(){DeepShare.dsLogDebug("Window event focusout"),clearTimeout(e)})},_=function(e,n){if(DeepShare.dsLogDebug("Go to tip: "+n),"ios"===e)switch(n){case c.destination.dstweixintipios:IsNullOrUndefined(i.base._DSCallbacks.weixinIOSTipCallback)?(DeepShare.dsLogDebug("weixin ios tip"),L(r.ds_url||r.ds_urls[a]||"")):i.base._DSCallbacks.weixinIOSTipCallback();break;case c.destination.dstweibotipios:IsNullOrUndefined(i.base._DSCallbacks.weiboIOSTipCallback)?(DeepShare.dsLogDebug("weibo ios tip"),L(r.ds_url||r.ds_urls[a]||"")):i.base._DSCallbacks.weiboIOSTipCallback();break;case c.destination.dstqqtipios:IsNullOrUndefined(i.base._DSCallbacks.qqIOSTipCallback)?(DeepShare.dsLogDebug("qq ios tip"),L(r.ds_url||r.ds_urls[a]||"")):i.base._DSCallbacks.qqIOSTipCallback()}else if("android"===e)switch(n){case c.destination.dstweixintipandroid:IsNullOrUndefined(i.base._DSCallbacks.weixinAndroidTipCallback)?(DeepShare.dsLogDebug("weixin android tip"),L(r.ds_url||r.ds_urls[a]||"")):i.base._DSCallbacks.weixinAndroidTipCallback();break;case c.destination.dstweibotipandroid:IsNullOrUndefined(i.base._DSCallbacks.weiboAndroidTipCallback)?(DeepShare.dsLogDebug("weibo android tip"),L(r.ds_url||r.ds_urls[a]||"")):i.base._DSCallbacks.weiboAndroidTipCallback();break;case c.destination.dstqqtipandroid:IsNullOrUndefined(i.base._DSCallbacks.qqAndroidTipCallback)?(DeepShare.dsLogDebug("qq android tip"),L(r.ds_url||r.ds_urls[a]||"")):i.base._DSCallbacks.qqAndroidTipCallback()}t=n,p(c.actionJSDst,t)},S=function(){DeepShare.dsLogDebug("cannot deeplink"),IsNullOrUndefined(i.base._DSCallbacks.cannotDeeplinkCallback)?(DeepShare.dsLogDebug("cannot deeplink"),L(r.ds_url||r.ds_urls[a]||"")):i.base._DSCallbacks.cannotDeeplinkCallback(),t=c.destination.dstcannotdeeplink,p(c.actionJSDst,t)},g=function(){DeepShare.dsLogDebug("Go to android new install"),r.is_download_directly?f():r.cannot_go_market?h():r.cannot_get_win_event||r.is_uc?k():w()},k=function(){t=c.destination.dstandroidMarketLandPage,DeepShare.dsLogDebug("Go to android market landing page: "+t),IsNullOrUndefined(i.base._DSCallbacks.androidMarketLandingCallback)?(DeepShare.dsLogDebug("android market"),L(r.ds_url||r.ds_urls[a]||"")):i.base._DSCallbacks.androidMarketLandingCallback(),p(c.actionJSDst,t)},h=function(){t=c.destination.dstandroidCannotGoMarketLandPage,DeepShare.dsLogDebug("Go to android can not go to market landing page: "+t),IsNullOrUndefined(i.base._DSCallbacks.androidCannotGoMarketLandingCallback)?(DeepShare.dsLogDebug("android cannot go market"),L(r.ds_url||r.ds_urls[a]||"")):i.base._DSCallbacks.androidCannotGoMarketLandingCallback(),p(c.actionJSDst,t)},f=function(){t=c.destination.dstandroidDirectDownloadLandPage,DeepShare.dsLogDebug("Go to android download landing page: "+t),IsNullOrUndefined(i.base._DSCallbacks.androidDownloadLandingCallback)?(DeepShare.dsLogDebug("android downloading url..."),C(s.download_url_android||r.url)):i.base._DSCallbacks.androidDownloadLandingCallback(),p(c.actionJSDst,t)},w=function(){t="market://details?id="+r.pkg,DeepShare.dsLogDebug("Go to android market: "+t),p(c.actionJSDst,t),l.windowLocation(t)},C=function(e){DeepShare.dsLogDebug("Goto url: "+e),b(!0,function(){t=e,p(c.actionJSDst,e),l.windowLocation(e)})},L=function(e){DeepShare.dsLogDebug("Goto universal link : "+e),t=e,p(c.actionJSDst,e),l.windowLocation(e)},m=function(e){"ios"===e?IsNullOrUndefined(i.base._DSCallbacks.iosPlatformNotAvailCallback)?(DeepShare.dsLogDebug("ios platform not available"),L(r.ds_url||r.ds_urls[a]||"")):i.base._DSCallbacks.iosPlatformNotAvailCallback():"android"===e&&(IsNullOrUndefined(i.base._DSCallbacks.androidPlatformNotAvailCallback)?(DeepShare.dsLogDebug("android platform not available"),L(r.ds_url||r.ds_urls[a]||"")):i.base._DSCallbacks.androidPlatformNotAvailCallback()),t=c.destination.dstplatformNA.replace(/{Platform}/g,e),p(c.actionJSDst,t)},v=function(e,i,n){o=e,DeepShare.dsLogDebug("deeplinklaunch: "+o),p(c.actionJSDeepLink,e),l.windowLocation(e);var a=setTimeout(function(){n()},i);D(a)},I=function(e,i){o=e;var n=null;try{p(c.actionJSDeepLink,e),n=l.windowOpen(e),DeepShare.dsLogDebug("chrome ios open pass")}catch(a){DeepShare.dsLogDebug("chrome ios open exception")}n?l.windowClose():i()},O=function(e,i,n){DeepShare.dsLogDebug("Go to iframeDeeplinkLaunch: "+e);var a=setTimeout(function(){n()},i);D(a);var t=document.createElement("iframe");t.style.width="1px",t.style.height="1px",t.border="none",t.style.display="none",t.src=e,document.body.appendChild(t),o=e,p(c.actionJSDeepLink,e)},y=function(){return r.is_ios&&(void 0===r.bundle_id||""===r.bundle_id)},N=function(){return r.is_android&&(void 0===r.pkg||""===r.pkg)},T=function(){return void 0!==r.yyb_url&&""!==r.yyb_url},A=function(e,i,n){DeepShare.dsLogDebug("Deal with iOS: "+e+" dst: "+i+" url: "+n),r.ios_major<=8&&!IsNullOrUndefined(n)?C(n):_(e,i)},q=function(e,i){r.is_ios?r.ios_major<9&&r.is_yyb_enable_ios_below_9?C(r.yyb_url):_("ios",e):r.is_android&&(r.is_yyb_enable_android?C(r.yyb_url):_("android",i))};this._Start=function(){var e=this;e._Start()},this.Start=function(){p("ds_jssdk_click","");var e="";if(y())return void m("ios");if(N())return void m("android");if(r.is_wechat)DeepShare.dsLogDebug("In WeChat"),q(c.destination.dstweixintipios,c.destination.dstweixintipandroid);else if(r.is_qq)DeepShare.dsLogDebug("In QQ"),q(c.destination.dstqqtipios,c.destination.dstqqtipandroid);else if(r.is_weibo)DeepShare.dsLogDebug("In Weibo"),r.is_ios?(DeepShare.dsLogDebug("isIOS"),A("ios",c.destination.dstweibotipios)):r.is_android&&(DeepShare.dsLogDebug("isAndroid"),_("android",c.destination.dstweibotipandroid));else if(r.is_ios)DeepShare.dsLogDebug("In iOS"),e=r.scheme+"://",r.match_id&&r.match_id.length>0&&(e+="?click_id="+r.match_id,e+="&deeplink_id="+a),DeepShare.dsLogDebug("Deeplink url: "+e),r.ios_major<9?(DeepShare.dsLogDebug("IOS Major below 9:"+r.ios_major),O(e,2e3,function(){C(s.download_url_ios||r.url)})):(DeepShare.dsLogDebug("IOS Major upper 9:"+r.ios_major),r.chrome_major>0?(DeepShare.dsLogDebug("isChrome"),I(e,function(){C(s.download_url_ios||r.url)})):(DeepShare.dsLogDebug("isUniversallink = true"),L(r.ds_url||r.ds_urls[a]||"")));else if(r.is_android)if(DeepShare.dsLogDebug("In Android"),e=r.scheme+"://"+r.host,r.match_id&&r.match_id.length>0&&(e+="?click_id="+r.match_id,e+="&deeplink_id="+a),DeepShare.dsLogDebug("Deeplink url: "+e),r.cannot_deeplink)O(e,2e3,function(){S()});else if(r.is_qq_browser)DeepShare.dsLogDebug("In QQ browser"),T()?(DeepShare.dsLogDebug(r.yyb_url),C(r.yyb_url)):S();else if(r.is_uc)DeepShare.dsLogDebug("In UC browser"),L(r.ds_url||r.ds_urls[a]||"");else if(r.chrome_major>=25&&!r.force_use_scheme){DeepShare.dsLogDebug("In chrome major >= 25, Chrome_major:"+r.chrome_major);var i=r.host;r.match_id&&r.match_id.length>0&&(i+="?click_id="+r.match_id,i+="&deeplink_id="+a);var o=r.pkg,t="intent://"+i+"#Intent;scheme="+toLowerCase(r.scheme)+";package="+o+";S.browser_fallback_url="+(s.download_url_android||r.url)+";end";v(t,2e3,function(){g()})}else DeepShare.dsLogDebug("In default browser"),O(e,2e3,function(){g()});d=n.DISMISSED},this.SetBindInfo=function(e){r=e},u(e),this.GetBindInfo=function(){return r},this.GetEnv=function(){return l},this.GetDsAction=function(){return c},this.GetDstLocation=function(){return t},this.GetDeeplinkLocation=function(){return o}}function IsNullOrEmpty(e){return!(e&&e.length>0)}function IsNullOrUndefined(e){return"undefined"==typeof e||null===e}function toLowerCase(e){return"string"==typeof e?e.toLowerCase():"undefined"==typeof object||null===object?"":(e=""+e,e.toLowerCase())}if(DeepShare.VERSION="2.4",DeepShare.DEBUG){var AWS_SERVER_IP="52.69.182.182";ws=new WebSocket("ws://"+AWS_SERVER_IP+":3333/"),ws.onopen=function(){var e=new Date;ws.send("[DEBUG] - ["+e.toLocaleTimeString()+'] - app name:"'+navigator.appName+'", app version:"'+navigator.app+'", platform:"'+navigator.platform+'", deepshare version:'+DeepShare.VERSION)},ws.onerror=function(){alert("connect to ws server error")}}DeepShare.dsLogDebug=function(e){if(DeepShare.DEBUG){var i=new Date;ws.readyState===ws.OPEN&&ws.send("[DEBUG] - ["+i.toLocaleTimeString()+"] - "+e)}},DS_kPostVerb="POST",DS_kRequestProtocol="https://",DS_kServerName="fds.so/",DS_kVersionName="v2/",DS_kAPIJS="jsapi/",DS_kDSTag="ds_tag";